---
layout: post
title: "CTA Map Visualization"
subtitle: "Analyzing ridership data on CTA metros from 2001 to 2021"
background: '/img/posts/map_viz/01.jpg'
---

<iframe width="560" height="315" src="https://www.youtube.com/embed/zdZ3D07TNTA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

The dashboard can be accessed from [<span style="color:blue">here</span>](https://ranga-aditya.shinyapps.io/424_Project2/).

## INTRO
This dashboard is designed to display ridership data in a simple and intuitive manner. Users can search for ridership data from any of the stations in the station input bar and the map, bar graph and tables change according to the inputs given. Users can select a particular date to see the activity in a particular station and can switch to the previous/next day using the buttons on the sidepanel. Users can also compare ridership data between two dates by clicking on the comparison option and setting the required dates. The bar graph displays a divergent graph that clearly highlights the difference in ridership values between the two dates. Users can view the plot of ridership over time period. The time period can be slected from the sidepanel and period can be set to Daily, Weekly, Monthly or Yearly. 

The project was developed in R using RStudio as the development enviroment and ShinyApps to deploy the dashboard. The dashboard was designed with the intent of running on a touch-screen wall with a resolution of 11,520 x 3,240.

## PREREQUISITES
- Installation of R and RStudio is necessary to run the application.

- For this project we'll be using a couple of libraries that can be installed using 'install.packages()'
```
install.packages("lubridate")
install.packages("DT")
install.packages("plotly)
install.packages("ggplot2")
install.packages("dplyr")
install.packages("tidyr")
install.packages("scales")
install.packages("shiny")
install.packages("shinydashboard")
```
- Due to the size limitations of ShinyApps, our data file must be less than 5 MB. We've chosen to breakup the file into chunks.

## PRE-PROCESSING
The data is sourced from the [<span style="color:blue">Chicago Data Portal</span>](https://data.cityofchicago.org/Transportation/CTA-Ridership-L-Station-Entries-Daily-Totals/5neh-572f/data) and the corresponding location data is taken from [<span style="color:blue">here</span>](https://data.cityofchicago.org/Transportation/CTA-System-Information-List-of-L-Stops/8pix-ypme)

The datasets are two Tab Separated Value(.tsv) files, consisting of 1.08 million and 300 rows of data respectively and contains the following attributes:

Ridership Dataset

| Column |  |Data Type |
| :-----|  |:------  |
| station_id |  |integer |
| stationname |  |string |
| date |  |Date |
| daytype |  |character |
| rides |  |integer |

Location Dataset

| Column |  |Data Type |
| :-----|  |:------  |
| STOP_ID |  | integer |
| DIRECTION_ID |  | string |
| STOP_NAME |  | string |
| STATION_NAME |  | string |
| STATION_DESCRIPTIVE_NAME |  | integer |
| MAP_ID |  | integer |
| ADA |  | boolean |
| RED |  | boolean |
| BLUE |  | boolean |
| G |  | boolean |
| BRN |  | boolean |
| P |  | boolean |
| Pexp |  | boolean |
| Y |  | boolean |
| Pnk |  | boolean |
| O |  | boolean |
| Location |  | string |

We first read the ridership data file into the R file as a data frame(cta_station) for manipulating the attributes and location data to lat_long. We then check for NULL values in the datasets.
```
ok <- complete.cases(cta_station)
dim(cta_station[ok, ]) == dim(cta_station)

ok <- complete.cases(lat_long)
dim(cta_station[ok, ]) == dim(lat_long)
```
We rename the station_id columns in both datasets for maerging later on
```
names(cta_station)[1] <- 'station_id'
names(lat_long)[6] <- 'station_id'
```

Taking a closer look at the attributes, the date column is a character data type which we need to convert to the date format
```
cta_station$date <- as.Date(cta_station$date, '%m/%d/%Y')
```

From the date column, we can engineer new features by individually extracting the year, month and week day and storing them in separate attributes.
```
cta_station$year <- as.numeric(format(cta_station$date, format='%Y'))
cta_station$month <- as.numeric(format(cta_station$date, format='%m'))
cta_station$day <- as.numeric(format(cta_station$date, format='%d'))
cta_station$week_day <- wday(cta_station$date, label=TRUE)
```

We can also create a month_name column that holds values of the months as string
```
name_of_month <- function(df){
  df$month_name[df$month==1] <- 'Jan'
  df$month_name[df$month==2] <- 'Feb'
  df$month_name[df$month==3] <- 'Mar'
  df$month_name[df$month==4] <- 'Apr'
  df$month_name[df$month==5] <- 'May'
  df$month_name[df$month==6] <- 'Jun'
  df$month_name[df$month==7] <- 'Jul'
  df$month_name[df$month==8] <- 'Aug'
  df$month_name[df$month==9] <- 'Sep'
  df$month_name[df$month==10] <- 'Oct'
  df$month_name[df$month==11] <- 'Nov'
  df$month_name[df$month==12] <- 'Dec'
  
  return(df)
  }
  ```

From the STATION_DESCRIPTIVE_NAME, we can engineer a new column 'line' that contains information regarding which lines the stations serve.
```
lat_long$line <- str_extract(lat_long$STATION_DESCRIPTIVE_NAME, "\\(.*\\)")
lat_long$line <- str_remove_all(lat_long$line, "[\\(\\)]")
```

We extract the relevant columns from lat_long necessary for our work
```
loc_data = subset(lat_long, select = c('station_id', 'Location', 'line'))
loc_data <- loc_data %>% distinct(station_id, line, .keep_all = TRUE)
```

By analysing the stationname column, we can observe that there are 148 uniques stations in the dataset.
```
unique(cta_station$stationname)
length(unique(cta_station$stationname))
```

We then merge both cta_station and lat_long to give the final dataframe
```
final_data <- left_join(cta_station, loc_data, on="station_id")
final_data
```

Handling the missing values and inconsistencies in final_data
```
# Fill Missing Data
final_data$Location[final_data$stationname == 'Randolph/Wabash'] = "(41.884431, -87.626149)"
final_data$line[final_data$stationname == 'Randolph/Wabash'] = "Green, Orange, Pink, Purple & Brown Lines"

final_data$Location[final_data$stationname == 'Madison/Wabash'] = "(41.882023, -87.626098)"
final_data$line[final_data$stationname == 'Madison/Wabash'] = "Brown, Green, Orange, Pink & Purple Lines"

final_data$Location[final_data$stationname == 'Washington/State'] = "(41.8837, -87.6278)"
final_data$line[final_data$stationname == 'Washington/State'] = "Red Line"

final_data$Location[final_data$stationname == 'Homan'] = "(41.884914, -87.711327)"
final_data$line[final_data$stationname == 'Homan'] = "Green Line"

# Change data regarding Pink Line
final_data$line[final_data$stationname == "54th/Cermak" & final_data$date < "2006-06-25"] <- "Blue Line"
```

This is the data file we'll be using for our dashboard.

## THE DASHBOARD
![Dashboard Interface](\img\posts\map_viz\interface.PNG)

The dashboard is divided into 4 componenets:
#### THE ABOUT SECTION
![About Page](\img\posts\map_viz\about.PNG)

Users can get a brief idea of the interface and how it's meant to be used. There's an introduction to the dataset, the link from it was sourced and a brief elaboration of the attributes.

#### MAP
![Map](\img\posts\map_viz\comparison.png)

Users can pan around the map of Chicago, zoom in or out and view data on the various stations. Selecting a station from the side panel calibrates the map to that stations locations with a pop-up showing information on the station such as the number of rides and lines that stations serves.

#### BAR GRAPH AND TABLE DATA
![Table Data](\img\posts\map_viz\table.PNG)

Users can see the daily ridership in each of the stations in the bar graph. Users can select a single date from the side panel and the graph and table change to reflect the values on that date. The lines that each station serves can be found on the bar and hovering above the bar gives further information regarding exact ridership number and line information. 
On selecting comparsion, users can select 2 dates to be compared and the bar graph displays a divergent bar graph which shows the change in rideship values across different stations. The blue bar indicates decrease in ridership and the red bar indicates increase. The tables accordingly change to reflect the change in ridership values when comparing the two dates.

#### STATIONS OF INTEREST
These are a set of pre-selected dates which have been observed to have an unusual pattern in ridership. Users can select on the tabs present in the interface to view the 10 dates in question. The description in each tab gives more information about the event in question and the potential impact its had on ridership numbers in the station for that period.

###### October 2019, O'Hare Airport
![DOI1](\img\posts\cta_viz\doi1.PNG)
There's a significant decline in ridership between September 28th to October 5th, 2019. Upon research, it was discovered that there was heavy rainfall and reports of a flash floods happening around that time which could have led to the possible decline in numbers. [<span style="color:blue">Source</span>](https://www.weather.gov/lot/03Oct2019_flashflooding)

###### 11th September 2001, O'Hare Aiport
![DOI2](\img\posts\cta_viz\doi2.PNG)
The attack on the Twin Towers had a significant impact on the general populace. Due to the nature of the attack, it could have possibly instilled a fear of travelling in the population and hence the decline in the number riders starting from September.

###### COVID-19 April 2020, UIC-Halsted
![DOI3](\img\posts\cta_viz\doi3.PNG)
Due to the pandemic and strict CDC guidelines, travelling was severely restricted and prompted classes to be held online. In-person classes then resumed on August 2021. These factors have led to a significant decline in riders which can be observed from April 2020 all the way to August 2021.

###### COVID-19 April 2020, O'Hare Airport
![DOI4](\img\posts\cta_viz\doi4.PNG)
The same trend can be observed for the O'Hare Airport station as well. Due to strict CDC guidelines, a number of flights were cancelled and/or grounded. While online classes would have helped keep ridership entries low, domestic and international travel is crucial for the economy which might be the reason why there's faster growth in numbers for this particular situation.

###### July 2008, O'Hare Airport
![DOI5](\img\posts\cta_viz\doi5.PNG)
There's a significant gap in ridership numbers at the O'Hare Airport station. Researching these dates found that Hurricane Ike occurred during this time with heavy rainfall and floods primarily the reasons why ridership fell so low. [<span style="color:blue">Source</span>](https://www.weather.gov/lot/Sept2008_Hurricane_Ike_Rainfall)

###### March 2014, O'Hare Airport
![DOI6](\img\posts\cta_viz\doi6.PNG)
A train derailed at the O'Hare airport station on March 24th, 2014. Due to maintenance and repair, the station was shutdown for 6 days and reopened on the 30th of March. This explains the gap present in the data. [<span style="color:blue">Source</span>](https://en.wikipedia.org/wiki/O%27Hare_station_train_crash)

###### October 2017, O'Hare Airport
![DOI7](\img\posts\cta_viz\doi7.PNG)
The Chicago Cubs were playing against the Washington Nationals during this time which could have contributed to the high spikes in ridership that we can observe for the month of October.

###### November 2008, O'Hare Airport
![DOI8](\img\posts\cta_viz\doi8.PNG)
There's a high spike in ridership number in the month of Novemebr. Research shows that Barack Obama addressed the people at Grant Park on November 8th 2008, which could be a possible reason in the spike ridership. The general ridership numbers start declining from October due to the onset of winter, which makes this spike in numbers all the more noticable. [<span style="color:blue">Source</span>](https://edition.cnn.com/2008/POLITICS/11/04/obama.transcript/)

###### Summer Break, UIC-Halsted
![DOI9](\img\posts\cta_viz\doi9.PNG)
On observation of ridership numbers at UIC-Halsted, a pattern emerges where there's a decline in ridership during the months of May to July. This could be attributed due to lack of students, since most of them would be on break at the time.

###### November 2016, O'Hare
![DOI10](\img\posts\cta_viz\doi10.PNG)
It was a historic moment for the people of Chicago when cubs won World Series on November 2nd, 2016. The high spikes in ridership numbers could be attributed to the popularity of the match considering it's the first time since 1908 that the Cubs had reached the finals. [<span style="color:blue">Source</span>](https://en.wikipedia.org/wiki/2016_World_Series)


## NEXT STEPS
Users can access the [<span style="color:blue">source code</span>](https://github.com/adi-r/424_Project1) if they wish to dive deep into the program and come up with their plots that they wish to visualize. Users can modify the selection of stations and choose their own to visualize and infer data from.  
